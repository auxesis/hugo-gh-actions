name: Screenshot PR changes

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    name: Build the website
    runs-on: ubuntu-latest
    steps:
    - name: üõí Checkout repo
      uses: actions/checkout@v2
      with:
        repository: ${{ secrets.WEBSITE_REPO }}
        token: ${{ secrets.ACCESS_TOKEN }}
        submodules: true
    - name: Build, Tag, Push
      uses: mattdavis0351/actions/docker-gpr@v1
      with:
        repo-token: ${{ secrets.ACCESS_TOKEN }}
        image-name: section-gh-action-www.section.io
#    - name: üõ† Build the Docker image
#      run: hugo server
#    - name: ‚¨ÜÔ∏è Upload the artifact
#      uses: actions/upload-artifact@v2
#      with:
#        name: website
#        path: public/

  screenshot:
    name: Screenshot the website
    needs: build
    runs-on: ubuntu-latest
    services:
      nginx:
        image: nginx
        # Map port 8080 on the Docker host to port 80 on the nginx container
        ports:
          - 8080:80
    steps:
    - name: üì∏ Screenshot Website
      uses: swinton/screenshot-website@v1.0.0
      with:
        source: http://localhost:8080/
        destination: screenshot.png
        full-page: true
