name: Screenshot PR changes

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    name: Build the website
    runs-on: ubuntu-latest
    steps:
    - name: ðŸ›’ Checkout repo
      uses: actions/checkout@v2
      with:
        repository: ${{ secrets.WEBSITE_REPO }}
        ref: add-entrypoint-to-dockerfile
        token: ${{ secrets.ACCESS_TOKEN }}
        submodules: true
    - name: Cache the image
      run: docker pull auxesis/section-gh-action-www.section.io
    - name: Build, Tag, Push
      uses: docker/build-push-action@v1
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        repository: auxesis/section-gh-action-www.section.io
        tags: latest

  screenshot:
    name: Screenshot the website
    needs: build
    runs-on: ubuntu-latest
    services:
      website:
        image: registry.hub.docker.com/auxesis/section-gh-action-www.section.io:latest
        ports:
          - 1313:1313
    steps:
    - name: test curl
      continue-on-error: true
      run: curl -v http://website:1313/
    - name: test curl
      continue-on-error: true
      run: curl -v http://localhost:1313/

#    - name: ðŸ“¸ Screenshot Website
#      uses: swinton/screenshot-website@v1.0.0
#      with:
#        source: http://localhost:1313/
#        destination: screenshot.png
#        full-page: true
